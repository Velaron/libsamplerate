name: build

on: [push]

env:
  # Customize the CMake build type here (Release, Debug, RelWithDebInfo, etc.)
  BUILD_TYPE: Release

jobs:
  build:
    strategy:
      fail-fast: false
      matrix:
        name: [
        linux-cmake,
        linux-autotools
        ]
        include:
          - name: linux-cmake
            os: ubuntu-latest
            build-system: cmake

          - name: linux-autotools
            os: ubuntu-latest
            build-system: autotools

    runs-on: ${{ matrix.os }}
    steps:
    - uses: actions/checkout@v2

    - name: Install Linux dependencies
      if: startsWith(matrix.os,'ubuntu')
      run: |
        sudo apt-get update -y
        sudo apt-get install -y libsndfile-dev libopus-dev libfftw3-dev libasound2-dev

    - name: Create CMake Build Environment
      if: startsWith(matrix.build-system,'cmake')
      run: cmake -E make_directory ${{runner.workspace}}/build

    - name: Configure CMake
      if: startsWith(matrix.build-system,'cmake')
      shell: bash
      working-directory: ${{runner.workspace}}/build
      run: cmake $GITHUB_WORKSPACE -DCMAKE_BUILD_TYPE=$BUILD_TYPE

    - name: Build CMake
      if: startsWith(matrix.build-system,'cmake')
      working-directory: ${{runner.workspace}}/build
      shell: bash
      run: cmake --build . --config $BUILD_TYPE

    - name: Test CMake
      if: startsWith(matrix.build-system,'cmake')
      working-directory: ${{runner.workspace}}/build
      run: ctest -C $BUILD_TYPE

    - name: Bootstrap Autotools
      if: startsWith(matrix.build-system,'autotools')
      shell: bash
      run: ./autogen.sh

    - name: Configure Autotools
      if: startsWith(matrix.build-system,'autotools')
      shell: bash
      run: ./configure --enable-sndfile --enable-alsa

    - name: Build Autotools
      if: startsWith(matrix.build-system,'autotools')
      shell: bash
      run: make

    - name: Test Autotools
      if: startsWith(matrix.build-system,'autotools')
      shell: bash
      run: make distcheck
